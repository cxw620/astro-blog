---
author: Hantong Chen
pubDatetime: 2024-12-18T19:09:36.000+08:00
# modDatetime: 
title: 关于云游戏的一些思考
featured: false
draft: true
tags:
  - misc
  - game
description: 关于云游戏的一些思考
---

今天 "`绝区一`" 开服, 但苦于手边没有电脑且手机性能已经带不动大型游戏, 遂安装 `云·绝区零`. 氪金 128, 秒开的体验极为震撼.

## Table of contents

## 导语

云游戏, 无非是将游戏在云端渲染, 将画面传送至移动端显示, 以解决移动端性能羸弱不足以支撑高质量游戏画面等问题.
有人称, 这将是游戏行业的未来.

然而, 目前云游戏价格依然居高不下, 即便是提供了免费游玩时长的服务, 也常常排队排到天荒地老, 体验极差.

## 为什么这么贵

### 硬件成本

玩家熟知的 NVIDIA, 在 GPU 市场可谓一家独大, 事实上的垄断地位 ~~这就给了老黄涨价的底气~~, 以下默认采购的是 NVIDIA 显卡.

玩家购买消费级显卡, 咬咬牙掏了钱, 卡就是自己的了, 不再有后续成本(除非损坏送修). 然而, 对于云游戏服务商而言, 消费级显卡
一般难以满足云游戏服务的需要, 主要原因如下:

- 硬件层面

  - 服务器平台主要采用强制被动风冷的方式进行散热, 然而消费级显卡的散热是按主动散热的方式设计的.
  - 受限于老黄刀法, 消费级显卡 VRAM 容量等级森严.

  为了解决这些问题, 只能和硬件厂商合作定制, 非工模的产品注定价格高昂.
- 软件层面

  - 驱动上, 老黄不给予 GPU 虚拟化的支持, 然而为了最大化利用 GPU 资源, 云游戏厂商不可能让每个玩家独占显卡.

  这个问题只能是游戏厂商自己下场, 例如米哈游, 针对性修改游戏相关代码, 允许单一系统同时运行多个游戏实例, 且玩家数据不会冲突.

有人可能会问, 那服务器显卡呢?

- GPU 虚拟化授权价格高昂, 似乎还不能买断.
- 服务器显卡往往是科学计算需求导向, 并不适合云游戏. 而且价格比消费级高得多.

### 带宽成本

中国商用带宽价格可谓十分美丽. 购买过云服务器的朋友都知道, 带宽价格可能比计算资源价格还要高.

国内从运营商拉一条 1G 专线, 价格起码过万元每月. 然而中国三大运营商间常相互使小手段, 跨运营商流量 QoS 极其严重, 这对云游戏来说是
致命的. 而 BGP 带宽的价格直接翻几倍.

~~也正是基于这个原因, 某 AC 站才针对性降低热门视频的码率, 以节省带宽成本.~~

为此, 米哈游目前是自建机房, 区分运营商, 就近提供服务, 其他云游戏厂商大抵如此.

## 为什么要要等待

显而易见, 非付费用户只能等待付费用户腾出空余的计算及带宽资源.

## 游戏串流: `Sunshine` & `Moonlight`

一些技术爱好者, 也包括我, 试图自建云游戏(串流)服务, 尝试将本地游戏 "上云", 一方面无需等待, 另一方面, 能够随时随地运行位于主机上的单机游戏.

论游戏串流, 开源方案最佳选择只有 [`Sunshine`](https://github.com/LizardByte/Sunshine) 和 [`Moonlight`](https://github.com/moonlight-stream).
然而, 毕竟是开源项目仰赖社区维护, 其自身乃至串流生态限制及不足之处颇多.

- 大部分联网游戏受游戏厂商安全策略限制, 不能多开, 虚拟机方案也会被检测.
- 即便是三端互通的游戏, 例如 `崩坏·星穹铁道` 和 `绝区零`, 并没有在 PC 客户端提供触屏模式(虽然代码层面支持).

  一个例外是 `原神`, 可能是逆向的手段, 有人发现了其官方云游戏的运行参数.

  此外, `崩坏·星穹铁道` 也能通过技术手段 hook 掉官方客户端内检测平台类型的调用, 模拟为移动端, 但此法有明确的封号风险.
- 虚拟输入设备性能较差, 尤其是 Windows 原生触屏操作能力就不行.
- VDD (Virtual Display Driver) 不完善, 不能基于客户端分辨率动态调整虚拟显示器分辨率, 且效率也较低, 和录屏兼容性也不佳.

  事实上, 理论最佳的解决方案是游戏直接离屏渲染, 数据在 GPU 显存内就地编码输出. 但这也是最近才较为成熟的技术了, 玩家也控制不了.
- 显卡同时承担编码和渲染任务, 对于特定显卡, 视频编码单元性能较差.

特别指出, 为了流畅的操控和游戏体验, 在虚拟输入这块技术难度还是相当高的, 事实上需要游戏本体和虚拟输入模块协同优化.

编解码层面, 如果客户端和服务器平台一致还好, 最怕但也最常见的是电脑端显示移动端 UI, 进行触控操作, 要么优化到极致, 对客户端进行一些特殊处理或者编写专门的触摸设备驱动, 要么只能利用 Windows 原生触摸操作.

传输层面, 为了降低操作时延, 必然采用 UDP 传输客户端的操作数据, 对丢包、延迟抖动等一系列网络波动情况在算法上的处理相当重要且难度高.
(当然对于 `崩坏·星穹铁道` 这种不在乎操作的也还好.)

## 米哈游是怎么做的

回到文章开头的感想. 秒开游戏, 估计也就米哈游这种自身既是游戏厂商也是云游戏服务提供商才能做到的了.

- 实例热载, 只需要给客户端传个登录信息就能秒开.

  对于个人用户而言, 不像移动端譬如安卓等, Windows 并没有单独挂起某个进程的能力, 所以这点不可能做到.
- 视频编码优化.

  毕竟是商业服务, 招了工程师专门干这事儿, 开源方案也只能用公共服务了.
- 钱给足.

  据传米哈游的云游戏亏本运营.

## 前景与展望

如果有时间的话, 我会在这些方面继续学习和努力:

- 魔改 Moonlight
- 魔改 Sunshine

需要的知识储备包括但不限于:

- 计算机网络
- 计算机图形, 尤其是视频编码技术
- 前端 (Vue)

---

碎碎念: 好久没写过文章, 才一千多字, 感觉人老了脑子不好使, 唉.
